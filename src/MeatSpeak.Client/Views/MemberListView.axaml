<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:MeatSpeak.Client.ViewModels"
             xmlns:state="using:MeatSpeak.Client.Core.State"
             xmlns:conv="using:MeatSpeak.Client.Converters"
             x:Class="MeatSpeak.Client.Views.MemberListView"
             x:DataType="vm:MemberListViewModel"
             Background="{StaticResource MemberListBgBrush}">

    <UserControl.Resources>
        <conv:NickColorConverter x:Key="NickColorConverter" />
        <conv:PrefixColorConverter x:Key="PrefixColorConverter" />
    </UserControl.Resources>

    <DockPanel>
        <!-- Header -->
        <Border DockPanel.Dock="Top" Height="48"
                BorderBrush="{StaticResource SeparatorBrush}"
                BorderThickness="0,0,0,1">
            <StackPanel Orientation="Horizontal" Margin="16,0"
                        VerticalAlignment="Center">
                <TextBlock Text="Members"
                           FontSize="13" FontWeight="SemiBold"
                           Foreground="{StaticResource TextSecondaryBrush}" />
                <TextBlock Text=" — "
                           Foreground="{StaticResource TextMutedBrush}" FontSize="13" />
                <TextBlock Text="{Binding MemberCount}"
                           FontSize="13"
                           Foreground="{StaticResource TextMutedBrush}" />
            </StackPanel>
        </Border>

        <!-- Grouped Member List -->
        <ScrollViewer>
            <StackPanel Margin="8,8">

                <!-- OPERATORS section -->
                <StackPanel IsVisible="{Binding Operators.Count}">
                    <TextBlock Margin="8,8,0,4" FontSize="11" FontWeight="SemiBold"
                               Foreground="{StaticResource TextMutedBrush}" LetterSpacing="1">
                        <Run Text="OPERATORS — " /><Run Text="{Binding Operators.Count, Mode=OneWay}" />
                    </TextBlock>
                    <ItemsControl ItemsSource="{Binding Operators}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="state:UserState">
                                <Button HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Left"
                                        Background="Transparent"
                                        Padding="8,6" CornerRadius="4">
                                    <Button.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="Message"
                                                      Command="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).MessageUserCommand}"
                                                      CommandParameter="{Binding Nick}" />
                                            <MenuItem Header="Whois"
                                                      Command="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).WhoisCommand}"
                                                      CommandParameter="{Binding Nick}" />
                                            <Separator IsVisible="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).IsCurrentUserOp}" />
                                            <MenuItem Header="Deop"
                                                      IsVisible="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).IsCurrentUserOp}"
                                                      Command="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).DeopCommand}"
                                                      CommandParameter="{Binding Nick}" />
                                            <MenuItem Header="Kick"
                                                      IsVisible="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).IsCurrentUserOp}"
                                                      Command="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).KickCommand}"
                                                      CommandParameter="{Binding Nick}" />
                                            <MenuItem Header="Ban"
                                                      IsVisible="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).IsCurrentUserOp}"
                                                      Command="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).BanCommand}"
                                                      CommandParameter="{Binding Nick}" />
                                        </ContextMenu>
                                    </Button.ContextMenu>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Ellipse Width="32" Height="32" Fill="#36393F" />
                                        <StackPanel VerticalAlignment="Center">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding ChannelPrefix}"
                                                           Foreground="{Binding ChannelPrefix, Converter={StaticResource PrefixColorConverter}}"
                                                           FontSize="13" />
                                                <TextBlock Text="{Binding Nick}"
                                                           Foreground="{Binding Nick, Converter={StaticResource NickColorConverter}}"
                                                           FontSize="14" />
                                            </StackPanel>
                                        </StackPanel>
                                    </StackPanel>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

                <!-- VOICED section -->
                <StackPanel IsVisible="{Binding Voiced.Count}">
                    <TextBlock Margin="8,8,0,4" FontSize="11" FontWeight="SemiBold"
                               Foreground="{StaticResource TextMutedBrush}" LetterSpacing="1">
                        <Run Text="VOICED — " /><Run Text="{Binding Voiced.Count, Mode=OneWay}" />
                    </TextBlock>
                    <ItemsControl ItemsSource="{Binding Voiced}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="state:UserState">
                                <Button HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Left"
                                        Background="Transparent"
                                        Padding="8,6" CornerRadius="4">
                                    <Button.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="Message"
                                                      Command="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).MessageUserCommand}"
                                                      CommandParameter="{Binding Nick}" />
                                            <MenuItem Header="Whois"
                                                      Command="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).WhoisCommand}"
                                                      CommandParameter="{Binding Nick}" />
                                            <Separator IsVisible="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).IsCurrentUserOp}" />
                                            <MenuItem Header="Op"
                                                      IsVisible="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).IsCurrentUserOp}"
                                                      Command="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).OpCommand}"
                                                      CommandParameter="{Binding Nick}" />
                                            <MenuItem Header="Devoice"
                                                      IsVisible="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).IsCurrentUserOp}"
                                                      Command="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).DevoiceCommand}"
                                                      CommandParameter="{Binding Nick}" />
                                            <MenuItem Header="Kick"
                                                      IsVisible="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).IsCurrentUserOp}"
                                                      Command="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).KickCommand}"
                                                      CommandParameter="{Binding Nick}" />
                                            <MenuItem Header="Ban"
                                                      IsVisible="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).IsCurrentUserOp}"
                                                      Command="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).BanCommand}"
                                                      CommandParameter="{Binding Nick}" />
                                        </ContextMenu>
                                    </Button.ContextMenu>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Ellipse Width="32" Height="32" Fill="#36393F" />
                                        <StackPanel VerticalAlignment="Center">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding ChannelPrefix}"
                                                           Foreground="{Binding ChannelPrefix, Converter={StaticResource PrefixColorConverter}}"
                                                           FontSize="13" />
                                                <TextBlock Text="{Binding Nick}"
                                                           Foreground="{Binding Nick, Converter={StaticResource NickColorConverter}}"
                                                           FontSize="14" />
                                            </StackPanel>
                                        </StackPanel>
                                    </StackPanel>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

                <!-- MEMBERS (regular) section -->
                <StackPanel>
                    <TextBlock Margin="8,8,0,4" FontSize="11" FontWeight="SemiBold"
                               Foreground="{StaticResource TextMutedBrush}" LetterSpacing="1">
                        <Run Text="MEMBERS — " /><Run Text="{Binding Regular.Count, Mode=OneWay}" />
                    </TextBlock>
                    <ItemsControl ItemsSource="{Binding Regular}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="state:UserState">
                                <Button HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Left"
                                        Background="Transparent"
                                        Padding="8,6" CornerRadius="4">
                                    <Button.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="Message"
                                                      Command="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).MessageUserCommand}"
                                                      CommandParameter="{Binding Nick}" />
                                            <MenuItem Header="Whois"
                                                      Command="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).WhoisCommand}"
                                                      CommandParameter="{Binding Nick}" />
                                            <Separator IsVisible="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).IsCurrentUserOp}" />
                                            <MenuItem Header="Op"
                                                      IsVisible="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).IsCurrentUserOp}"
                                                      Command="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).OpCommand}"
                                                      CommandParameter="{Binding Nick}" />
                                            <MenuItem Header="Voice"
                                                      IsVisible="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).IsCurrentUserOp}"
                                                      Command="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).VoiceCommand}"
                                                      CommandParameter="{Binding Nick}" />
                                            <MenuItem Header="Kick"
                                                      IsVisible="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).IsCurrentUserOp}"
                                                      Command="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).KickCommand}"
                                                      CommandParameter="{Binding Nick}" />
                                            <MenuItem Header="Ban"
                                                      IsVisible="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).IsCurrentUserOp}"
                                                      Command="{Binding $parent[UserControl].((vm:MemberListViewModel)DataContext).BanCommand}"
                                                      CommandParameter="{Binding Nick}" />
                                        </ContextMenu>
                                    </Button.ContextMenu>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Ellipse Width="32" Height="32" Fill="#36393F" />
                                        <StackPanel VerticalAlignment="Center">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding ChannelPrefix}"
                                                           Foreground="{Binding ChannelPrefix, Converter={StaticResource PrefixColorConverter}}"
                                                           FontSize="13" />
                                                <TextBlock Text="{Binding Nick}"
                                                           Foreground="{Binding Nick, Converter={StaticResource NickColorConverter}}"
                                                           FontSize="14" />
                                            </StackPanel>
                                        </StackPanel>
                                    </StackPanel>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

            </StackPanel>
        </ScrollViewer>
    </DockPanel>
</UserControl>
